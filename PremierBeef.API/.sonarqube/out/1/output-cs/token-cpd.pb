ž
KD:\Proyectos\NetCore\UPC_PI2_Backend\PremierBeef.Mail\EmailConfiguration.cs
	namespace 	
PremierBeef
 
. 
Mail 
{ 
public 

class 
EmailConfiguration #
{ 
public 
string 
From 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 

SmtpServer  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
int 
Port 
{ 
get 
; 
set "
;" #
}$ %
public 
string 
UserName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public		 
string		 
Password		 
{		  
get		! $
;		$ %
set		& )
;		) *
}		+ ,
}

 
} ¯=
DD:\Proyectos\NetCore\UPC_PI2_Backend\PremierBeef.Mail\EmailSender.cs
	namespace 	
PremierBeef
 
. 
Mail 
{ 
public 

class 
EmailSender 
: 
IEmailSender +
{ 
private 
readonly 
EmailConfiguration +
_emailConfig, 8
;8 9
public

 
EmailSender

 
(

 
EmailConfiguration

 -
emailConfig

. 9
)

9 :
{ 	
_emailConfig 
= 
emailConfig &
;& '
} 	
public 
void 
	SendEmail 
( 
Message %
message& -
)- .
{ 	
var 
emailMessage 
= 
CreateEmailMessage 1
(1 2
message2 9
)9 :
;: ;
Send 
( 
emailMessage 
) 
; 
} 	
public 
async 
Task 
SendEmailAsync (
(( )
Message) 0
message1 8
)8 9
{ 	
var 
mailMessage 
= 
CreateEmailMessage 0
(0 1
message1 8
)8 9
;9 :
await 
	SendAsync 
( 
mailMessage '
)' (
;( )
} 	
private 
MimeMessage 
CreateEmailMessage .
(. /
Message/ 6
message7 >
)> ?
{ 	
var 
emailMessage 
= 
new "
MimeMessage# .
(. /
)/ 0
;0 1
emailMessage   
.   
From   
.   
Add   !
(  ! "
new  " %
MailboxAddress  & 4
(  4 5
$str  5 <
,  < =
_emailConfig  > J
.  J K
From  K O
)  O P
)  P Q
;  Q R
emailMessage!! 
.!! 
To!! 
.!! 
AddRange!! $
(!!$ %
message!!% ,
.!!, -
To!!- /
)!!/ 0
;!!0 1
emailMessage"" 
."" 
Subject""  
=""! "
message""# *
.""* +
Subject""+ 2
;""2 3
var$$ 
bodyBuilder$$ 
=$$ 
new$$ !
BodyBuilder$$" -
{$$. /
HtmlBody$$0 8
=$$9 :
string$$; A
.$$A B
Format$$B H
($$H I
$str$$I j
,$$j k
message$$l s
.$$s t
Content$$t {
)$${ |
}$$} ~
;$$~ 
if&& 
(&& 
message&& 
.&& 
Attachments&& #
!=&&$ &
null&&' +
&&&&, .
message&&/ 6
.&&6 7
Attachments&&7 B
.&&B C
Any&&C F
(&&F G
)&&G H
)&&H I
{'' 
byte(( 
[(( 
](( 
	fileBytes((  
;((  !
foreach)) 
()) 
var)) 

attachment)) '
in))( *
message))+ 2
.))2 3
Attachments))3 >
)))> ?
{** 
using++ 
(++ 
var++ 
ms++ !
=++" #
new++$ '
MemoryStream++( 4
(++4 5
)++5 6
)++6 7
{,, 

attachment-- "
.--" #
CopyTo--# )
(--) *
ms--* ,
)--, -
;--- .
	fileBytes.. !
=.." #
ms..$ &
...& '
ToArray..' .
(... /
)../ 0
;..0 1
}// 
bodyBuilder11 
.11  
Attachments11  +
.11+ ,
Add11, /
(11/ 0

attachment110 :
.11: ;
FileName11; C
,11C D
	fileBytes11E N
,11N O
ContentType11P [
.11[ \
Parse11\ a
(11a b

attachment11b l
.11l m
ContentType11m x
)11x y
)11y z
;11z {
}22 
}33 
emailMessage55 
.55 
Body55 
=55 
bodyBuilder55  +
.55+ ,
ToMessageBody55, 9
(559 :
)55: ;
;55; <
return66 
emailMessage66 
;66  
}77 	
private99 
void99 
Send99 
(99 
MimeMessage99 %
mailMessage99& 1
)991 2
{:: 	
using;; 
(;; 
var;; 
client;; 
=;; 
new;;  #

SmtpClient;;$ .
(;;. /
);;/ 0
);;0 1
{<< 
try== 
{>> 
client?? 
.?? 
Connect?? "
(??" #
_emailConfig??# /
.??/ 0

SmtpServer??0 :
,??: ;
_emailConfig??< H
.??H I
Port??I M
,??M N
true??O S
)??S T
;??T U
client@@ 
.@@ $
AuthenticationMechanisms@@ 3
.@@3 4
Remove@@4 :
(@@: ;
$str@@; D
)@@D E
;@@E F
clientAA 
.AA 
AuthenticateAA '
(AA' (
_emailConfigAA( 4
.AA4 5
UserNameAA5 =
,AA= >
_emailConfigAA? K
.AAK L
PasswordAAL T
)AAT U
;AAU V
clientCC 
.CC 
SendCC 
(CC  
mailMessageCC  +
)CC+ ,
;CC, -
}DD 
catchEE 
{FF 
throwHH 
;HH 
}II 
finallyJJ 
{KK 
clientLL 
.LL 

DisconnectLL %
(LL% &
trueLL& *
)LL* +
;LL+ ,
clientMM 
.MM 
DisposeMM "
(MM" #
)MM# $
;MM$ %
}NN 
}OO 
}PP 	
privateRR 
asyncRR 
TaskRR 
	SendAsyncRR $
(RR$ %
MimeMessageRR% 0
mailMessageRR1 <
)RR< =
{SS 	
usingTT 
(TT 
varTT 
clientTT 
=TT 
newTT  #

SmtpClientTT$ .
(TT. /
)TT/ 0
)TT0 1
{UU 
tryVV 
{WW 
awaitXX 
clientXX  
.XX  !
ConnectAsyncXX! -
(XX- .
_emailConfigXX. :
.XX: ;

SmtpServerXX; E
,XXE F
_emailConfigXXG S
.XXS T
PortXXT X
,XXX Y
trueXXZ ^
)XX^ _
;XX_ `
clientYY 
.YY $
AuthenticationMechanismsYY 3
.YY3 4
RemoveYY4 :
(YY: ;
$strYY; D
)YYD E
;YYE F
awaitZZ 
clientZZ  
.ZZ  !
AuthenticateAsyncZZ! 2
(ZZ2 3
_emailConfigZZ3 ?
.ZZ? @
UserNameZZ@ H
,ZZH I
_emailConfigZZJ V
.ZZV W
PasswordZZW _
)ZZ_ `
;ZZ` a
await\\ 
client\\  
.\\  !
	SendAsync\\! *
(\\* +
mailMessage\\+ 6
)\\6 7
;\\7 8
}]] 
catch^^ 
{__ 
throwaa 
;aa 
}bb 
finallycc 
{dd 
awaitee 
clientee  
.ee  !
DisconnectAsyncee! 0
(ee0 1
trueee1 5
)ee5 6
;ee6 7
clientff 
.ff 
Disposeff "
(ff" #
)ff# $
;ff$ %
}gg 
}hh 
}ii 	
}jj 
}kk ˜
ED:\Proyectos\NetCore\UPC_PI2_Backend\PremierBeef.Mail\IEmailSender.cs
	namespace 	
PremierBeef
 
. 
Mail 
{ 
public 

	interface 
IEmailSender !
{ 
void 
	SendEmail 
( 
Message 
message &
)& '
;' (
Task 
SendEmailAsync 
( 
Message #
message$ +
)+ ,
;, -
} 
} „
@D:\Proyectos\NetCore\UPC_PI2_Backend\PremierBeef.Mail\Message.cs
	namespace 	
PremierBeef
 
. 
Mail 
{ 
public 

class 
Message 
{ 
public 
List 
< 
MailboxAddress "
>" #
To$ &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public		 
string		 
Subject		 
{		 
get		  #
;		# $
set		% (
;		( )
}		* +
public

 
string

 
Content

 
{

 
get

  #
;

# $
set

% (
;

( )
}

* +
public 
IFormFileCollection "
Attachments# .
{/ 0
get1 4
;4 5
set6 9
;9 :
}; <
public 
Message 
( 
IEnumerable "
<" #
string# )
>) *
to+ -
,- .
string/ 5
subject6 =
,= >
string? E
contentF M
,M N
IFormFileCollectionO b
attachmentsc n
)n o
{ 	
To 
= 
new 
List 
< 
MailboxAddress (
>( )
() *
)* +
;+ ,
To 
. 
AddRange 
( 
to 
. 
Select !
(! "
x" #
=>$ &
new' *
MailboxAddress+ 9
(9 :
$str: A
,A B
xC D
)D E
)E F
)F G
;G H
Subject 
= 
subject 
; 
Content 
= 
content 
; 
Attachments 
= 
attachments %
;% &
} 	
} 
} 